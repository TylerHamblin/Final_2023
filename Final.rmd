---
title: "Covid19 Vaccine Study Final2023"
author: "Tyler Hamblin"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
FinalDat <-read.csv(file="final.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- FinalDat  %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))

male = filter(FinalData, sex =="M")
female = filter(FinalData, sex =="F")
lgbtq = filter(FinalData, LGBTQ =="gay")
drugUser = filter(FinalData, DrugUser =="yes")

```

# Introduction

A new  preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of sub populations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.


$H_0$ : The data for the preventative vaccine has no statistical significance to changing infection rate across the listed sub populations. 


$H_A$ : The data for the preventative vaccine does have statistical significance in how it prevents infection for each sub group. 



# Methods
According to the data set this is going to be a categorical situation explained by another categorical variable. After creating separate data sets for each of the sub populations we will use the CandP helper files to graphically display bar charts, pull xtabs commands for numerical data, run Chi-Squared for inferential data, and end with Fisher code to declare a confidence interval. Since we are limiting this investigation to two types of data there are no loops required to measure multiple variables. 

# Results

## Males

### Graphical Results
```{r}
barchartGC(~infected + treatment,data=male)
barchartGC(~infected + treatment,data=male, type="percent")
```


The above barchart compares the graphical results for only the male sub group from the data set. It displays the rates of contracting Covid-19 explained by whether or not the individual was vaccinated. The left side of the chart accounts for those with positive test results and the right shows people who did not contract it. More than twice the amount of people in the Covid-19 category only had the placebo, suggesting that the vaccine does have efficacy for this group. 

### Numerical Results
```{r}
tableMale <- xtabs(~infected + treatment, data=male)
rowPerc(tableMale)
colPerc(tableMale)
```


These numerical results confirm the suggestions from the barchart that people who have the vaccine tend to contract Covid-19 half as much as the people who only received the placebo. The placebo got it about 70% of the time and the vaccinated group got it 30%. Again our assumption is that the vaccination is effective for males. 

### Inferential Results
```{r}
chisq.test(tableMale)
chisqtestGC(tableMale)
maleFisher <- fisher.test(tableMale)
maleFisher
```



The Chi Squared test produces a p-value that is significantly smaller than the suggested 0.05 limit. Coming in at $1.098\times10^{-13}$ , there is even greater evidence that a statistical significance is responsible for the data. The Chi-squared statistic is 55 which comes in larger than the degrees of freedom for this data. The chance of an unvaccinated male getting Covid-19 are 2.2 times higher than a male with the vaccine. 

### Confidence Interval
```{r}
oddsMale = maleFisher$estimate/(maleFisher$estimate+1)*100
print(oddsMale)
maleLow=(maleFisher$conf.int[1]/(maleFisher$conf.int[1]+1))*100
maleHigh=(maleFisher$conf.int[2]/(maleFisher$conf.int[2]+1))*100
cat("\n","Condifence interval for Males: ",maleLow," to ",maleHigh)
```


The confidence interval for this data set is >50% which meets the typical vaccine threshold of >60%. This is enough data to confidently say that the vaccine is a good option for preventing the contraction of Covid-19 for males. 

## Females

### Graphical Results
```{r}
barchartGC(~infected + treatment,data=female)
barchartGC(~infected + treatment,data=female, type="percent")
```

### Numerical Results
```{r}
tableFemale <- xtabs(~infected + treatment, data=female)
rowPerc(tableFemale)
colPerc(tableFemale)
```

### Inferential Results
```{r}
chisq.test(tableFemale)
chisqtestGC(tableFemale)
femaleFisher <- fisher.test(tableFemale)
femaleFisher
```


### Confidence Interval
```{r}
oddsFemale = femaleFisher$estimate/(femaleFisher$estimate +1)*100
print(oddsFemale)
femaleLow=(femaleFisher$conf.int[1]/(femaleFisher$conf.int[1]+1))*100
femaleHigh=(femaleFisher$conf.int[2]/(femaleFisher$conf.int[2]+1))*100
cat("\n","Condifence interval for Females: ",femaleLow," to ",femaleHigh)
```

## LGBTQ

### Graphical Results
```{r}
barchartGC(~infected + treatment,data=lgbtq)
barchartGC(~infected + treatment,data=lgbtq, type="percent")
```

### Numerical Results
```{r}
tableLGBTQ <- xtabs(~infected + treatment, data=lgbtq)
rowPerc(tableLGBTQ)
colPerc(tableLGBTQ)
```

### Inferential Results
```{r}
chisq.test(tableLGBTQ)
chisqtestGC(tableLGBTQ)
lgbtqFisher <- fisher.test(tableLGBTQ)
lgbtqFisher
```

### Confidence Interval
```{r}
oddsLGBTQ = lgbtqFisher$estimate/(lgbtqFisher$estimate +1)*100
print(oddsLGBTQ)
lgbtqLow=(lgbtqFisher$conf.int[1]/(lgbtqFisher$conf.int[1]+1))*100
lgbtqHigh=(lgbtqFisher$conf.int[2]/(lgbtqFisher$conf.int[2]+1))*100
cat("\n","Condifence interval for LGBTQ: ",lgbtqLow," to ",lgbtqHigh)
```

## Druggies

### Graphical Results
```{r}
barchartGC(~infected + treatment,data=drugUser)
barchartGC(~infected + treatment,data=drugUser, type="percent")
```

### Numerical Results
```{r}
tableDrug <- xtabs(~infected + treatment, data=drugUser)
rowPerc(tableDrug)
colPerc(tableDrug)
```

### Inferential Results
```{r}
chisq.test(tableDrug)
chisqtestGC(tableDrug)
drugFisher <- fisher.test(tableDrug)
drugFisher
```

### Confidence Interval
```{r}
oddsDrug = drugFisher$estimate/(drugFisher$estimate +1)*100
print(oddsDrug)
drugLow=(drugFisher$conf.int[1]/(drugFisher$conf.int[1]+1))*100
drugHigh=(drugFisher$conf.int[2]/(drugFisher$conf.int[2]+1))*100
cat("\n","Condifence interval for Drug Users: ",drugLow," to ",drugHigh)
```


# Overall Results and Conclusions






